<% provide :page_title, t('other.event', event: @event.title) %>

<div class="event">
  <div class="event-info row">
    <div class="col-md-12 event-info-inner rounded">
      <%= content_tag 'div', '', class: 'event-background',
        style: "background-image: url(#{asset_path('event.jpg')})" %>

      <div class="row event-banner">
        <div class="col-md-8 px-4 py-3">
          <div class="event-description">
            <%= content_tag(:h1, @event.title, class: 'text-center fw-light') %>
            <%= content_tag(:h3, l(@event.datetime, format: :short), class: 'fw-lighter') %>
            <%= content_tag(:h3, link_to(@event.address, "https://yandex.ru/maps/?text=#{@event.address}"),
                 class: 'fw-light text-info') %>
            <h3>
              <%= button_tag t('.show_on_map'), data: {'bs-toggle' => 'modal', 'bs-target' => '#staticBackdrop'},
                 class: 'btn btn-warning active btn-sm fs-5'%>
            </h3>
            <%= content_tag(:p, @event.description, class: 'text-break') %>
          </div>

          <div class="form-group mb-2">
            <% if current_user_can_edit?(@event) %>
              <div class="buffer-top">
                <%= link_to t('buttons.change'), edit_event_path(@event),
                  class: 'btn btn-secondary mb-1 rounded-pill' %>
                <%= link_to t('buttons.event_delete'), event_path(@event), class: 'btn btn-danger mb-1 rounded-pill',
                  method: :delete, data: { confirm: t('.are_you_sure') } %>
              </div>
            <% end %>
          </div>

          <div class="row justify-content-md-center">
            <div class="col-md-11 my-4">
              <% if @event.comments.exists? %>
                <%= content_tag(:h3, t('.comments', count: @event.comments.count), class: 'fw-light') %>
                 <%= render partial: 'comments/commentable' %>
                </div>
              <% else %>
                <%= content_tag(:em, content_tag(:h6, t('.no_comments_yet'), class: 'text-center my-5 text-secondary')) %>
              <% end %>
            </div>
          </div>

          <div class="col-md-6">
            <% if @event.subscriptions.exists? %>
              <div class="event-subscriptions mt-3">
                <%= content_tag(:h3, t('titles.event_subscribers', count: @event.subscriptions.count), class: 'mb-3') %>
                <div>
                  <div class="form-group mb-2">
                    <%= render partial: 'subscriptions/subscription',
                collection: @event.subscriptions.except(@new_subscription).shuffle %>
                  </div>
                </div>
              </div>
            <% else %>
              <%= content_tag(:em, content_tag(:p, t('.members_be_here'), class: 'text-center text-secondary my-3')) %>
            <% end %>
            <% unless @event.user == current_user || @event.subscribers.include?(current_user) %>
            <div class="buffer-both">
              <%= render partial: 'subscriptions/form', locals: {
            subscription: @new_subscription || @event.subscriptions.build
          } %>
            </div>
          <% end %>
        </div>

      </div>

    </div>
  </div>
</div></div></div>
